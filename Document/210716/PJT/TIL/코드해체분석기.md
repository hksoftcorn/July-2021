# ì½”ë“œ í•´ì²´ ë¶„ì„ê¸°

## 1. ëª…ì„¸ì„œ

> Keywords: `Vu3`, `Element UI Plus`, `Vuex`

### 1.1. Vue 3

- ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë°©ì‹ ë³€í™”
- Template ì„ ì–¸
- Composition API : setup()
- Composition API : (on) lifecyclehook
- Composition API : props & emit

### 1.2. í´ë” êµ¬ì¡°

![](C:\Users\multicampus\AppData\Roaming\Typora\typora-user-images\image-20210713181534319.png)

### 1.3. ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ 

- ë¡œê·¸ì¸



## 2. Source Code

ë¡œê·¸ì¸ì— ëŒ€í•œ ì†ŒìŠ¤ ì½”ë“œ ë¶„ì„

### 2.1. Main

![image-20210713182622918](ì½”ë“œí•´ì²´ë¶„ì„ê¸°.assets/image-20210713182622918.png)

- main ë””ë ‰í† ë¦¬ êµ¬ì¡°
  - components
    - login
    - footer
    - header
    - sidebar
  - store `(= vuex)`
    - actions
    - getters
    - index
    - mutations
    - state
  - main.css
  - main.vue
  - menu.json



### 2.2. main - components

![image-20210713182953423](ì½”ë“œí•´ì²´ë¶„ì„ê¸°.assets/image-20210713182953423.png)

- components 
  - login

  - ~~footer - í•˜ë‹¨~~

    ![image-20210713183046398](ì½”ë“œí•´ì²´ë¶„ì„ê¸°.assets/image-20210713183046398.png)

  - header

  - ~~sidebar - ì˜†~~

    ![image-20210713183117383](ì½”ë“œí•´ì²´ë¶„ì„ê¸°.assets/image-20210713183117383.png)



## 3. Component

### 3.1. main.vue

> ë©”ì¸ì—ì„œëŠ” ë¡œê·¸ì¸ ë° íšŒì›ê°€ì…ì—ì„œ ì˜¬ë¼ì˜¨ ì´ë²¤íŠ¸ë¥¼ ë°›ì•„ì£¼ê³ , Dialogì˜ ìƒíƒœë¥¼ ë‚´ë ¤ì¤ë‹ˆë‹¤.

```vue
<template>
  <el-container class="main-wrapper">
    <main-header
      :height="`70px`"
      @openLoginDialog="onOpenLoginDialog"
      @openSigninDialog="onOpenSigninDialog"
      />
    <el-container class="main-container">
      <el-aside class="hide-on-small" width="240px">
        <main-sidebar
          :width="`240px`"/>
      </el-aside>
      <el-main>
        <router-view></router-view>
      </el-main>
    </el-container>
    <main-footer :height="`110px`"/>
  </el-container>
  <login-dialog
    :open="loginDialogOpen"
    @closeLoginDialog="onCloseLoginDialog"/>
  <signin-dialog
    :open="signinDialogOpen"
    @closeSigninDialog="onCloseSigninDialog"/>
</template>
<style>
  @import "https://unpkg.com/element-plus/lib/theme-chalk/index.css";
  @import './main.css';
  @import '../../common/css/common.css';
  @import '../../common/css/element-plus.css';

</style>
<script>
import LoginDialog from './components/login-dialog'
import SigninDialog from './components/signin-dialog'
import MainHeader from './components/main-header'
import MainSidebar from './components/main-sidebar'
import MainFooter from './components/main-footer'
import { useRouter } from 'vue-router'
import { useStore } from 'vuex'

export default {
  name: 'Main',
  components: {
    MainHeader,
    MainSidebar,
    MainFooter,
    LoginDialog,
    SigninDialog
  },
  data () {
    return {
      loginDialogOpen: false,
      signinDialogOpen: false,
    }
  },
  methods: {
    onOpenLoginDialog () {
      this.loginDialogOpen = true
    },
    onCloseLoginDialog () {
      this.loginDialogOpen = false
    },
    onOpenSigninDialog () {
      this.signinDialogOpen = true
    },
    onCloseSigninDialog () {
      this.signinDialogOpen = false
    },
    setToken: function () {
      const token = localStorage.getItem('jwt')
      const config = {
        Authorization: `Bearer ${token}`
      }
      return config
    },
  },
  computed: {
    userId: function () {
      const store = useStore()
      return store.getters['root/getUserId']
    }
  }
}

</script>

```

### 3.2. main-header

> í—¤ë” ë¡œê³ , ê²€ìƒ‰, ë¡œê·¸ì¸, íšŒì›ê°€ì… ì´ë²¤íŠ¸ë¥¼ ë³´ë‚´ì–´ Dialogë¥¼ êº¼ëƒ…ë‹ˆë‹¤.

```vue
<template>
  <!-- Notice. í•´ì„¤ì€ í•´ë‹¹ì½”ë“œ ìœ„ì— ì ì–´ë‘ì—ˆìŠµë‹ˆë‹¤. -->
  <!-- https://atom.io/packages/element-ui-snippets
  1) el-rowëŠ” Vue Element-UI Snippetsìœ¼ë¡œ ê·¸ë¦¬ë“œë¥¼ ì¡ì•„ì¤ë‹ˆë‹¤.
  2) gutter ë˜í•œ css grid layoutì— ì‚¬ìš©ë˜ëŠ” íŒŒë¼ë¯¸í„° ì…ë‹ˆë‹¤. A gutter is the clear empty space between an elementâ€™s boundaries and the elementâ€™s content.
  -->
  <el-row
    class="main-header"
    :gutter="10"
    :style="{ 'height': height }">
    <!-- 3) í•˜ë‹¨ì— hide-on-smallê³¼ hide-on-big í´ë˜ìŠ¤ê°€ ë³´ì…ë‹ˆë‹¤. ì´ëŠ” í™”ë©´ í¬ê¸°ì— ë”°ë¼ ë³´ì—¬ì§€ëŠ” UIê°€ ë‹¬ë¼ì§€ê²Œ ë©ë‹ˆë‹¤. -->
    <!-- 4) í° í™”ë©´ì—ì„œì˜ UIì…ë‹ˆë‹¤. -->
    <div class="hide-on-small">
      <!-- 4-1) ë¡œê³ ë¥¼ ëˆ„ë¥´ë©´ í™ˆí™”ë©´ìœ¼ë¡œ ëŒì•„ì˜µë‹ˆë‹¤.-->
      <div class="logo-wrapper" @click="clickLogo"><div class="ic ic-logo"/></div>
      <div class="tool-wrapper">
        <!-- 4-2) ê²€ìƒ‰ ë°”ì…ë‹ˆë‹¤. -->
        <div class="search-field">
          <el-input
            placeholder="ê²€ìƒ‰"
            prefix-icon="el-icon-search"
            v-model="state.searchValue">
          </el-input>
        </div>
        <!-- 4-3) íšŒì›ê°€ì… ë° ë¡œê·¸ì¸ ë²„íŠ¼ì…ë‹ˆë‹¤. -->
        <div class="button-wrapper">
          <div v-if="userInfo.userId">
            <!-- ì˜¤ë¥¸ìª½ ì •ë ¬ í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤..-->
            <span style="margin-right: 5px;">
            ì•ˆë…•í•˜ì„¸ìš”, {{ userInfo.userId }}ë‹˜
            </span>
            <el-button type="primary" @click="clickLogout">ë¡œê·¸ì•„ì›ƒ</el-button>
          </div>
          <div v-else>
            <el-button @click="clickSignin">íšŒì›ê°€ì…</el-button>
            <el-button type="primary" @click="clickLogin">ë¡œê·¸ì¸</el-button>
          </div>
        </div>
      </div>

    </div>
    <!-- 5) ì‘ì€ í™”ë©´ì—ì„œì˜ UIì…ë‹ˆë‹¤. -->
    <div class="hide-on-big">
      <!-- 5-1) ë©”ë‰´ ì•„ì´ì½˜ì„ ëˆŒë €ì„ ì‹œ ì™¼ìª½ ë©”ë‰´ë°”ê°€ ë³´ì…ë‹ˆë‹¤. -->
      <div class="menu-icon-wrapper" @click="changeCollapse"><i class="el-icon-menu"></i></div>
      <div class="logo-wrapper" @click="clickLogo"><div class="ic ic-logo"/></div>
      <div class="menu-icon-wrapper"><i class="el-icon-search"></i></div>
      <!-- 5-2) ì™¼ìª½ ë©”ë‰´ë°”ì˜ ìƒíƒœë¥¼ ë°”ê¿”ì£¼ëŠ” ì½”ë“œê°€ ì¸ìƒì ì´ë„¤ìš” ;ã……;
      const state ë¡œ ì •ì˜ëœ ë³€ìˆ˜ì•ˆì— isCollapse ë¼ëŠ” ì†ì„±ê°’ì„ !(ë°˜ëŒ€ë¡œ) ë°”ê¿”ì¤ë‹ˆë‹¤.
      -->
      <div class="mobile-sidebar-wrapper" v-if="!state.isCollapse">
        <div class="mobile-sidebar">
          <div class="mobile-sidebar-tool-wrapper">
            <!-- 5-3) ë¡œê³ ë¥¼ ëˆ„ë¥´ë©´ í™ˆí™”ë©´ìœ¼ë¡œ ëŒì•„ì˜¤ëŠ” ë“¯ ë³´ì˜€ìœ¼ë‚˜, ê¸°ëŠ¥ì´ ì—†ëŠ” ì´ë¯¸ì§€ì˜€ë„¤ìš”.
              problem : ë™ì‘í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
              solving : @click="clickLogo" ì¶”ê°€ -->
            <div class="logo-wrapper"><div class="ic ic-logo" @click="clickLogo"/></div>
            <!-- 5-4) íšŒì›ê°€ì… ë° ë¡œê·¸ì¸ ë²„íŠ¼ì…ë‹ˆë‹¤. -->
            <!-- <div v-if="userInfo.userId">
              <el-button type="primary" class="mobile-sidebar-btn login-btn" @click="clickLogout">ë¡œê·¸ì•„ì›ƒ</el-button>
            </div> -->
            <!-- <div v-else> -->
            <el-button type="primary" class="mobile-sidebar-btn login-btn" @click="clickLogin">ë¡œê·¸ì¸</el-button>
            <el-button class="mobile-sidebar-btn register-btn" @click="clickSignin">íšŒì›ê°€ì…</el-button>
            <!-- </div> -->
          </div>
          <!-- 5-5) https://atom.io/packages/element-ui-snippets#menu
          el-menuëŠ” Vue Element-UI Snippetsìœ¼ë¡œ ë©”ë‰´ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.
            default-activeëŠ” activeIndexë¥¼ ë¶ˆëŸ¬ì˜¤ê³ 
              activeIndexëŠ” getters(vuex)ì—ì„œ Activeëœ ë©”ë‰´ ì¸ë±ìŠ¤ ê°€ì ¸ì˜µë‹ˆë‹¤.
            active-text-color í˜„ì¬ ì„ íƒëœ(Active) ë©”ë‰´ì— ìƒ‰ìƒì„ ì…í™ë‹ˆë‹¤.
            menuSelectì„ í†µí•´ì„œ ì„ íƒëœ ë©”ë‰´ë¡œ ì´ë™í•©ë‹ˆë‹¤.
          -->
          <el-menu
            :default-active="String(state.activeIndex)"
            active-text-color="#ffd04b"
            class="el-menu-vertical-demo"
            @select="menuSelect">
            <!-- 5-6) state ì•ˆì˜ menuItemsì„ í•˜ë‚˜ì”© êº¼ë‚´ì¤ë‹ˆë‹¤.
            menuItemsì€ gettersì—ì„œ getMenus í•¨ìˆ˜ë¥¼ í†µí•´ ë©”ë‰´ ê°ì²´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
              getMeneusëŠ” menu.jsonì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
              menuItemsì—ì„œ ì•„ì´ì½˜ê³¼ ì´ë¦„ì„ ê°€ì ¸ì™€ì„œ menuArrayì— ë‹´ìŠµë‹ˆë‹¤.
            keyë¡œëŠ” indexë¥¼, indexë¡œëŠ” stringí˜•íƒœì˜ indexìœ¼ë¡œ í•˜ë‚˜ë´…ë‹ˆë‹¤..?
             -->
            <el-menu-item v-for="(item, index) in state.menuItems" :key="index" :index="index.toString()">
              <!-- 5-7) ë§Œì•½ ì•„ì´ì½˜ì´ ìˆë‹¤ë©´ icë¥¼ ë¶™ì—¬ì¤ë‹ˆë‹¤.
                <i class="ic el-icon-s-home"></i>
              -->
              <i v-if="item.icon" :class="['ic', item.icon]"/>
              <span>{{ item.title }}</span>
            </el-menu-item>
          </el-menu>
        </div>
        <!-- 5-8) ë©”ë‰´ë°” ë°–ì„ í´ë¦­í–ˆì„ ì‹œ state.isCollapseì˜ ìƒíƒœë¥¼ ë°”ê¿”ì¤ë‹ˆë‹¤.(* 5-2 ì°¸ê³ )-->
        <div class="mobile-sidebar-backdrop" @click="changeCollapse"></div>
      </div>
    </div>
  </el-row>
</template>


<script>
import { reactive, computed } from 'vue'
import { useStore } from 'vuex'
import { useRouter } from 'vue-router'

export default {
  // 1) vue ì»´í¬ë„ŒíŠ¸ ì´ë¦„ì…ë‹ˆë‹¤.
  name: 'main-header',

  // 2) propsë¥¼ í†µí•´ height ë³€ìˆ˜ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.
  // main.vueì—ì„œ :height="`70px`" ë³´ëƒˆë„¤ìš”.
  props: {
    height: {
      type: String,
      default: '70px'
    }
  },
  // 3) setupì„ ì‚¬ìš©í•´ë³¼ê¹Œìš”?
  // dataì™€ methodsê°€ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
  // propsì™€ emitì„ ì •ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤.
  setup(props, { emit }) {
    // ìœ„ì—ì„œ import useStoreì™€ useRouter í–ˆë„¤ìš”
    const store = useStore()
    const router = useRouter()

    const userInfo = reactive({
      userId: computed(() => store.getters['root/getUserId'])
    })

    // https://v3.ko.vuejs.org/guide/reactivity.html
    // reactive := ë³€ê²½ ì œì–´
    // ì¶”ê°€ ê°œë… Proxy => Reflect, track, trigger
    // stateì—ëŠ” 4ê°œ searchValue, isCollapse, menuItems => menuArray, activeIndex
    const state = reactive({
      searchValue: null,
      isCollapse: true,
      menuItems: computed(() => {
        const MenuItems = store.getters['root/getMenus']
        let keys = Object.keys(MenuItems)
        let menuArray = []
        for (let i = 0; i < keys.length; ++i) {
          let menuObject = {}
          menuObject.icon = MenuItems[keys[i]].icon
          menuObject.title = MenuItems[keys[i]].name
          menuArray.push(menuObject)
        }
        return menuArray
      }),
      activeIndex: computed(() => store.getters['root/getActiveMenuIndex'])
    })
    // gettersì—ì„œ getActiveMenuIndex í•¨ìˆ˜ì— findIndexê°€ ìˆìŠµë‹ˆë‹¤.
    // return keys.findIndex(item => item === state.activeMenu)
    // ì§€ê¸ˆ vue.js devtoolsê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•„ í™•ì¸í•˜ì§€ëŠ” ëª»í–ˆì§€ë§Œ
    // ì•„ë§ˆ item === state.activeMenuì— ë¶€í•©í•˜ì§€ ì•Šì€ ì¡°ê±´ì€ -1ìœ¼ë¡œ ë°˜í™˜í•˜ë‚˜ ë´…ë‹ˆë‹¤.
    // ë”°ë¼ì„œ activeIndex ê°’ì´ -1ì¸ ë©”ë‰´ëŠ” activeIndex 0ìœ¼ë¡œ ë°”ê¿”ì¤ë‹ˆë‹¤.
    if (state.activeIndex === -1) {
      state.activeIndex = 0
      store.commit('root/setMenuActive', 0)
    }

    // ì„ íƒí•œ ë©”ë‰´ë¡œ ë¼ìš°íŒ… í•´ì£¼ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
    // ğŸ¤¦â€â™‚ï¸ì•„ì§ì€ ì˜¨ì „íˆ ì´í•´ë˜ì§€ ì•Šì€ ë“¯ í•©ë‹ˆë‹¤..
    // --paramì˜ í™œìš©--
    // ì•„ë˜ì˜ clickLogo í•¨ìˆ˜ì™€ ì—®ì–´ì„œ ì´í•´í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.
    // clickLogoì˜ ê²½ìš° Home ìœ¼ë¡œ ë¼ìš°íŒ…í•´ì£¼ëŠ”ë°, index=0ìœ¼ë¡œ ë°€ì–´ì£¼ë‚˜ ë´…ë‹ˆë‹¤.
    // ë§ˆì°¬ê°€ì§€ë¡œ menuSelectì—ì„œ paramì´ indexë¥¼ ì˜ë¯¸í•˜ë©°, indexëŠ” ìœ„ templateì—ì„œ v-forì—ì„œ ë°›ì•„ì™”ìŠµë‹ˆë‹¤.
    // Homeì€ 0, HistoryëŠ” 1ì…ë‹ˆë‹¤.
    const menuSelect = function (param) {
      store.commit('root/setMenuActive', param)
      // console.log(param)
      const MenuItems = store.getters['root/getMenus']
      let keys = Object.keys(MenuItems)
      router.push({
        name: keys[param]
      })
    }
    const clickLogo = () => {
      store.commit('root/setMenuActive', 0)
      const MenuItems = store.getters['root/getMenus']
      let keys = Object.keys(MenuItems)
      router.push({
        name: keys[0]
      })
    }
    // ë¡œê·¸ì¸ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´, emitìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ë¶€ëª¨ë¡œ ì˜¬ë ¤ë³´ëƒ…ë‹ˆë‹¤.
    // main.vueì—ì„œ í™•ì¸í•´ë´…ì‹œë‹¤!
    const clickLogin = () => {
      emit('openLoginDialog')
    }
    // íšŒì›ê°€ì… ë²„íŠ¼ë„ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.
    const clickSignin = () => {
      console.log('click signin!!')
      emit('openSigninDialog')
    }
    // ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ì„ ëˆ„ë¦…ë‹ˆë‹¤.
    const clickLogout = () => {
      console.log('logout')
      localStorage.removeItem('jwt')
      location.reload()
    }
    // state ì•ˆì˜ isCollapseì˜ ìƒíƒœë¥¼ ë°”ê¾¸ì–´ì¤ë‹ˆë‹¤.
    const changeCollapse = () => {
      state.isCollapse = !state.isCollapse
    }
    // í˜„ì¬ê¹Œì§€ ì •ì˜í•œ ê²ƒì„ return í•©ë‹ˆë‹¤.
    // ë³€ìˆ˜ : state, userInfo
    // í•¨ìˆ˜ : menuSelect, clickLogo, clickLogin, clickSignin, changeCollapse
    return { state, userInfo, menuSelect, clickLogo, clickLogin, clickSignin, clickLogout, changeCollapse }
  },
}
</script>
```

### 3.3. login-dialog

> ë¡œê·¸ì¸ ì´ë²¤íŠ¸ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.

```vue
<template>
  <!-- ë¡œê·¸ì¸ dialogë¥¼ ë„ì›ë‹ˆë‹¤.
   state.dialogVisibleëŠ” props.openìœ¼ë¡œ propsë¥¼ ë°›ì•„ì™”ìŠµë‹ˆë‹¤.
   handleCloseì€ emit ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ mainìœ¼ë¡œ ì˜¬ë¦½ë‹ˆë‹¤.
  -->
  <el-dialog
    custom-class="login-dialog"
    title="ë¡œê·¸ì¸"
    v-model="state.dialogVisible"
    @close="handleClose"
  >
  <!-- https://atom.io/packages/element-ui-snippets#menu
    :model ê³¼ :rules ì„ ì—°ê²°í•©ë‹ˆë‹¤.
    ğŸ‘€ ref="loginForm"  => const loginForm = ref(null) ì´ë¼ëŠ”ë°, ì™œ ì‚¬ìš©í•˜ëŠ”ì§€ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤.
    ë¼ë²¨ì„ ì™¼ìª½ ì •ë ¬í•©ë‹ˆë‹¤.
    -->
    <el-form :model="state.form" :rules="state.rules" ref="loginForm" :label-position="state.form.align">
      <!-- formì—ì„œ ë°›ì€ ì†ì„±ë“¤ì„ propìœ¼ë¡œ ë°›ì•„ì¤ë‹ˆë‹¤. -->
      <el-form-item prop="id" label="ì•„ì´ë””" :label-width="state.formLabelWidth">
        <el-input v-model="state.form.id" autocomplete="off"></el-input>
      </el-form-item>
      <el-form-item prop="password" label="ë¹„ë°€ë²ˆí˜¸" :label-width="state.formLabelWidth">
        <el-input v-model="state.form.password" autocomplete="off" @keyup.enter="clickLogin" show-password></el-input>
      </el-form-item>
    </el-form>
    <!-- dialogì˜ í•˜ë‹¨ ë¶€ë¶„ì…ë‹ˆë‹¤. -->
    <template #footer>
      <span class="dialog-footer">
        <el-button type="primary" @click="clickLogin" @keyup.enter="clickLogin" :disabled="!state.isValid">ë¡œê·¸ì¸</el-button>
      </span>
    </template>
  </el-dialog>
</template>
<style>
.login-dialog {
  width: 400px !important;
  height: 300px;
}
.login-dialog .el-dialog__headerbtn {
  float: right;
}
.login-dialog .el-form-item__content {
  margin-left: 0 !important;
  float: right;
  width: 200px;
  display: inline-block;
}
.login-dialog .el-form-item {
  margin-bottom: 20px;
}
.login-dialog .el-form-item__error {
  font-size: 12px;
  color: red;
}
.login-dialog .el-input__suffix {
  display: none;
}
.login-dialog .el-dialog__footer {
  margin: 0 calc(50% - 80px);
  padding-top: 0;
  display: inline-block;
}
.login-dialog .dialog-footer .el-button {
  width: 120px;
}
</style>

<script>
import { reactive, computed, ref, onMounted } from 'vue'
import { useStore } from 'vuex'

export default {
  name: 'login-dialog',

  props: {
    open: {
      type: Boolean,
      default: false
    }
  },

  setup(props, { emit }) {
    const store = useStore()
    // ë§ˆìš´ë“œ ì´í›„ ë°”ì¸ë”© ë  ì˜ˆì • - ì»¨í…ìŠ¤íŠ¸ì— ë…¸ì¶œì‹œì¼œì•¼í•¨. <return>
    const loginForm = ref(null)

    /*
      // Element UI Validator
      // rulesì˜ ê°ì²´ í‚¤ ê°’ê³¼ formì˜ ê°ì²´ í‚¤ ê°’ì´ ê°™ì•„ì•¼ ë§¤ì¹­ë˜ì–´ ì ìš©ë¨
      //
    */
    const state = reactive({
      form: {
        id: '',
        password: '',
        align: 'left'
      },
      rules: {
        id: [
          { required: true, message: 'Please input ID', trigger: 'blur' },
          { max: 16, message: 'ìµœëŒ€ 16ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', trigger: 'blur' },
        ],
        password: [
          { required: true, message: 'Please input password', trigger: 'blur' },
          { min: 9, message: 'ìµœì†Œ 9ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', trigger: 'blur' },
          { max: 16, message: 'ìµœëŒ€ 16ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', trigger: 'blur' },
          { pattern: /^(?=.*[A-Za-z])(?=.*\d)(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{0,}$/ , message: 'ìµœëŒ€ 16ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', trigger: 'blur' },
        ]
      },
      dialogVisible: computed(() => props.open),
      formLabelWidth: '120px',
      isValid: computed (() => {
        if (loginForm.value == null) return false;
        let flag = false;
        loginForm.value.validate((valid) => {
          flag = valid;
        })
        return flag;
      })

    })

    // loginForm.valueë¥¼ í™•ì¸í•´ë´…ì‹œë‹¤.
    onMounted(() => {
      // console.log(loginForm)
      // console.log(loginForm.value)
    })

    // ë¡œê·¸ì¸ í´ë¦­ í•¨ìˆ˜ì…ë‹ˆë‹¤.
    const clickLogin = function () {
      // ë¡œê·¸ì¸ í´ë¦­ ì‹œ validate ì²´í¬ í›„ ê·¸ ê²°ê³¼ ê°’ì— ë”°ë¼, ë¡œê·¸ì¸ API í˜¸ì¶œ ë˜ëŠ” ê²½ê³ ì°½ í‘œì‹œ
      loginForm.value.validate((valid) => {
        // ë§Œì•½ ìœ íš¨í•˜ë‹¤ë©´
        if (valid) {
          console.log('submit')
          // 500 error ê°€ ë°œìƒí•©ë‹ˆë‹¤.
          // í† í°ì´ ì—†ì–´ì„œ ì¼ê¹Œìš”, íšŒì›ì •ë³´ê°€ ì—†ì–´ì„œ ì¼ê¹Œìš”?
          store.dispatch('root/requestLogin', { user_id: state.form.id, password: state.form.password })
          .then(function (result) {
            alert('accessToken: ' + result.data.accessToken)
            localStorage.setItem('jwt', result.data.accessToken)

            // user idë¥¼ stateì— ì €ì¥
            store.commit('root/setUserId', state.form.id)
            const userId = store.getters['root/getUserId']

            handleClose()
          })
          .catch(function (err) {
            console.log('valid pass but catch')
            alert(err)
          })
        } else {
          // ìœ íš¨í•˜ì§€ ì•Šë‹¤ë©´
          console.log('Validate error')
          alert('Validate error!')
        }
      });
    }
    // ë‹«ìœ¼ë©´ idì™€ passwordë¥¼ ì›ë˜ëŒ€ë¡œ ë³µêµ¬í•©ë‹ˆë‹¤.
    // emitì„ í†µí•´ eventë¥¼ ë„˜ê²¨ì¤ë‹ˆë‹¤.
    const handleClose = function () {
      state.form.id = ''
      state.form.password = ''
      emit('closeLoginDialog')
    }

    return { loginForm, state, clickLogin, handleClose }
  }
}
</script>
```

### 3.4. signin-dialog

> íšŒì›ê°€ì… ì´ë²¤íŠ¸ë¥¼ ë³´ëƒ…ë‹ˆë‹¤.

```vue
<template>
  <!-- íšŒì›ê°€ì… dialogë¥¼ ë„ì›ë‹ˆë‹¤.
   state.dialogVisibleëŠ” props.openìœ¼ë¡œ propsë¥¼ ë°›ì•„ì™”ìŠµë‹ˆë‹¤.
   handleCloseì€ emit ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ mainìœ¼ë¡œ ì˜¬ë¦½ë‹ˆë‹¤.
  -->
  <el-dialog
    custom-class="login-dialog"
    title="íšŒì›ê°€ì…"
    v-model="state.dialogVisible"
    @close="handleClose"
  >
  <!-- https://atom.io/packages/element-ui-snippets#menu
    :model ê³¼ :rules ì„ ì—°ê²°í•©ë‹ˆë‹¤.
    ğŸ‘€ ref="loginForm"  => const loginForm = ref(null) ì´ë¼ëŠ”ë°, ì™œ ì‚¬ìš©í•˜ëŠ”ì§€ ëª¨ë¥´ê² ìŠµë‹ˆë‹¤.
    ë¼ë²¨ì„ ì™¼ìª½ ì •ë ¬í•©ë‹ˆë‹¤.
    -->
    <el-form :model="state.form" :rules="state.rules" ref="signinForm" :label-position="state.form.align">
      <!-- formì—ì„œ ë°›ì€ ì†ì„±ë“¤ì„ propìœ¼ë¡œ ë°›ì•„ì¤ë‹ˆë‹¤. -->
      <el-form-item prop="name" label="ì´ë¦„" :label-width="state.formLabelWidth">
        <el-input v-model="state.form.name" autocomplete="off"></el-input>
      </el-form-item>
      <el-form-item prop="department" label="ì†Œì†" :label-width="state.formLabelWidth">
        <el-input v-model="state.form.department" autocomplete="off"></el-input>
      </el-form-item>
      <el-form-item prop="position" label="ì§ì±…" :label-width="state.formLabelWidth">
        <el-input v-model="state.form.position" autocomplete="off"></el-input>
      </el-form-item>
      <el-form-item prop="user_id" label="ì•„ì´ë””" :label-width="state.formLabelWidth">
        <el-input v-model="state.form.user_id" autocomplete="off"></el-input>
        <!-- <el-button type="primary" @click="checkId">ì¤‘ë³µ í™•ì¸</el-button> -->
      </el-form-item>
      <el-form-item prop="password" label="ë¹„ë°€ë²ˆí˜¸" :label-width="state.formLabelWidth">
        <el-input v-model="state.form.password" autocomplete="off" show-password></el-input>
      </el-form-item>
      <el-form-item prop="passwordConfirm" label="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" :label-width="state.formLabelWidth">
        <el-input v-model="state.form.passwordConfirm" autocomplete="off" show-password></el-input>
      </el-form-item>
    </el-form>
    <!-- dialogì˜ í•˜ë‹¨ ë¶€ë¶„ì…ë‹ˆë‹¤. -->
    <template #footer>
      <span class="dialog-footer">
        <el-button type="primary" @click="clickSignin" @keyup.enter="clickSignin">ê°€ì…í•˜ê¸°</el-button>
      </span>
    </template>
  </el-dialog>
</template>
<style>
.login-dialog {
  width: 400px !important;
  height: 550px;
}
.login-dialog .el-dialog__headerbtn {
  float: right;
}
.login-dialog .el-form-item__content {
  margin-left: 0 !important;
  float: right;
  width: 200px;
  display: inline-block;
}
.login-dialog .el-form-item {
  margin-bottom: 20px;
}
.login-dialog .el-form-item__error {
  font-size: 12px;
  color: red;
}
.login-dialog .el-input__suffix {
  display: none;
}
.login-dialog .el-dialog__footer {
  margin: 0 calc(50% - 80px);
  padding-top: 0;
  display: inline-block;
}
.login-dialog .dialog-footer .el-button {
  width: 120px;
}
</style>

<script>
import { reactive, computed, ref, onMounted } from 'vue'
import { useStore } from 'vuex'

export default {
  name: 'signin-dialog',

  props: {
    open: {
      type: Boolean,
      default: false
    }
  },

  setup(props, { emit }) {
    const store = useStore()
    // ë§ˆìš´ë“œ ì´í›„ ë°”ì¸ë”© ë  ì˜ˆì • - ì»¨í…ìŠ¤íŠ¸ì— ë…¸ì¶œì‹œì¼œì•¼í•¨. <return>
    const signinForm = ref(null)

    const state = reactive({
      form: {
        name: '',
        department: '',
        position: '',
        user_id: '',
        password: '',
        passwordConfirm: '',
        align: 'left'
      },
      rules: {
        name: [
          { required: true, message: 'í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.', trigger: 'blur' },
          { max: 30, message: 'ìµœëŒ€ 30ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', trigger: 'blur' },
        ],
        department: [
          { required: false},
          { max: 30, message: 'ìµœëŒ€ 30ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', trigger: 'blur' },
        ],
        position: [
          { required: false},
          { max: 30, message: 'ìµœëŒ€ 30ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', trigger: 'blur' },
        ],
        user_id: [
          { required: true, message: 'í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.', trigger: 'blur' },
          { max: 16, message: 'ìµœëŒ€ 16ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', trigger: 'blur' },
        ],
        password: [
          { required: true, message: 'í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.', trigger: 'blur' },
          { min: 9, message: 'ìµœì†Œ 9ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', trigger: 'blur' },
          { max: 16, message: 'ìµœëŒ€ 16ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', trigger: 'blur' },
          { pattern: /^(?=.*[A-Za-z])(?=.*\d)(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{0,}$/ , message: 'ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìê°€ ì¡°í•©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.', trigger: 'blur' },
        ],
        passwordConfirm: [
          { required: true, message: 'í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.', trigger: 'blur' },
          { min: 9, message: 'ìµœì†Œ 9ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', trigger: 'blur' },
          { max: 16, message: 'ìµœëŒ€ 16ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.', trigger: 'blur' },
          { pattern: /^(?=.*[A-Za-z])(?=.*\d)(?=.*[$@$!%*#?&])[A-Za-z\d$@$!%*#?&]{0,}$/ , message: 'ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìê°€ ì¡°í•©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.', trigger: 'blur' },
          { validator: passwordConfirmValid, trigger: 'blur' },
        ]
      },
      dialogVisible: computed(() => props.open),
      formLabelWidth: '120px',
    })

    // signinForm.valueë¥¼ í™•ì¸í•´ë´…ì‹œë‹¤.
    onMounted(() => {
      console.log(signinForm.value)
    })

    // ì œëŒ€ë¡œ ë™ì‘ x
    var passwordConfirmValid = (rule, value, callback) => {
      if (value !== this.state.form.password) {
        callback(new Error('ì…ë ¥í•œ ë¹„ë°€ë²ˆí˜¸ì™€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.'));
      } else {
        callback();
      }
    }

    // ì•„ì´ë”” ì¤‘ë³µ í™•ì¸ í•¨ìˆ˜ì…ë‹ˆë‹¤.
    const checkId = function () {
      store.dispatch('root/getUserInfo')
      .then(function (result) {
        console.log('')
      })
      console.log('click')
      // axios ë¶€ë¥´ê³  DBì—ì„œ ì•„ì´ë”” ì¤‘ë³µ í™•ì¸í•œ í›„
      async
    }


    // ë¡œê·¸ì¸ í´ë¦­ í•¨ìˆ˜ì…ë‹ˆë‹¤.
    const clickSignin = function () {
      console.log('click')
      // ë¡œê·¸ì¸ í´ë¦­ ì‹œ validate ì²´í¬ í›„ ê·¸ ê²°ê³¼ ê°’ì— ë”°ë¼, ë¡œê·¸ì¸ API í˜¸ì¶œ ë˜ëŠ” ê²½ê³ ì°½ í‘œì‹œ
      signinForm.value.validate((valid) => {
        // ë§Œì•½ ìœ íš¨í•˜ë‹¤ë©´
        if (valid) {
          // console.log('submit')
          store.dispatch('root/requestSignin', {
            name: state.form.name,
            department: state.form.department,
            position: state.form.position,
            user_id: state.form.user_id,
            password: state.form.password,
            passwordConfirm: state.form.passwordConfirm,
            })
          .then(function (result) {
            console.log('success')
            handleClose()
          })
          .catch(function (err) {
            alert(err)
          })
        } else {
          // ìœ íš¨í•˜ì§€ ì•Šë‹¤ë©´
          alert('Validate error!')
        }
      });
    }
    // ë‹«ìœ¼ë©´ idì™€ passwordë¥¼ ì›ë˜ëŒ€ë¡œ ë³µêµ¬í•©ë‹ˆë‹¤.
    // emitì„ í†µí•´ eventë¥¼ ë„˜ê²¨ì¤ë‹ˆë‹¤.
    const handleClose = function () {
      state.form.name = ''
      state.form.department = ''
      state.form.position = ''
      state.form.user_id = ''
      state.form.password = ''
      state.form.passwordConfirm = ''
      emit('closeSigninDialog')
    }

    return { signinForm, state, checkId, clickSignin, handleClose }
  }
}
</script>

```

